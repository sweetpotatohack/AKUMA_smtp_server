#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–§–µ–Ω—è's –°–£–ü–ï–†-–ü–£–ü–ï–† –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –∑–∞–ø–∏—Å–µ–π
–¢–µ–ø–µ—Ä—å —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò –ø–æ–ª–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏!
"""

def create_correct_dns_section():
    return '''
================================================================================
üî• –û–°–ù–û–í–ù–´–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ó–ê–ü–ò–°–ò (–ë–ï–ó –ù–ò–• –ù–ò–ß–ï–ì–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢!)
================================================================================

1. üìç A-–ó–ê–ü–ò–°–¨ (–°–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–¥–¥–æ–º–µ–Ω mail —Å IP)
   –¢–∏–ø: A
   –ò–º—è: mail.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: mail.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: $SERVER_IP
   TTL: 3600 (1 —á–∞—Å)

2. üìß MX-–ó–ê–ü–ò–°–¨ (–£–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä)
   –¢–∏–ø: MX
   –ò–º—è: $DOMAIN (–∫–æ—Ä–Ω–µ–≤–æ–π –¥–æ–º–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: 10 mail.$DOMAIN
   –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 10
   TTL: 3600

================================================================================
üõ°Ô∏è –ó–ê–©–ò–¢–ù–´–ï –ó–ê–ü–ò–°–ò (SPF, DKIM, DMARC) - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –î–õ–Ø –î–û–°–¢–ê–í–õ–Ø–ï–ú–û–°–¢–ò!
================================================================================

3. üõ°Ô∏è SPF-–ó–ê–ü–ò–°–¨ (–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
   –¢–∏–ø: TXT
   –ò–º—è: $DOMAIN (–∫–æ—Ä–Ω–µ–≤–æ–π –¥–æ–º–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: v=spf1 mx a:mail.$DOMAIN ~all
   TTL: 3600

4. üîê DKIM-–ó–ê–ü–ò–°–¨ (–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –ø–∏—Å–µ–º)
   –¢–∏–ø: TXT
   –ò–º—è: default._domainkey.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: default._domainkey.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: $DKIM_RECORD
   TTL: 3600

5. üìä DMARC-–ó–ê–ü–ò–°–¨ (–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–ø—Ä–æ—à–µ–¥—à–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫—É –ø–∏—Å–µ–º)
   –¢–∏–ø: TXT
   –ò–º—è: _dmarc.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: _dmarc.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: v=DMARC1; p=quarantine; rua=mailto:dmarc@$DOMAIN; ruf=mailto:dmarc@$DOMAIN; sp=quarantine; adkim=r; aspf=r
   TTL: 3600

================================================================================
üöÄ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–î–û–ë–ù–´–ï –ê–õ–ò–ê–°–´ (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û, –ù–û –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
================================================================================

6. üåê CNAME –¥–ª—è SMTP (–£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
   –¢–∏–ø: CNAME
   –ò–º—è: smtp.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: smtp.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: mail.$DOMAIN
   TTL: 3600

7. üì© CNAME –¥–ª—è IMAP (–£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
   –¢–∏–ø: CNAME
   –ò–º—è: imap.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: imap.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: mail.$DOMAIN
   TTL: 3600

8. üì§ CNAME –¥–ª—è POP3 (–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ POP3)
   –¢–∏–ø: CNAME
   –ò–º—è: pop3.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: pop3.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: mail.$DOMAIN
   TTL: 3600

9. üíª CNAME –¥–ª—è –≤–µ–±-–ø–æ—á—Ç—ã (–ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ)
   –¢–∏–ø: CNAME
   –ò–º—è: webmail.$DOMAIN (–Ω–∞–ø—Ä–∏–º–µ—Ä: webmail.example.com)
   –ó–Ω–∞—á–µ–Ω–∏–µ: mail.$DOMAIN
   TTL: 3600

================================================================================
‚ö° PTR-–ó–ê–ü–ò–°–¨ (–û–ë–†–ê–¢–ù–´–ô DNS) - –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø –†–ï–ü–£–¢–ê–¶–ò–ò!
================================================================================

10. üîÑ PTR-–ó–ê–ü–ò–°–¨ (–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —É —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞!)
    IP: $SERVER_IP
    PTR: mail.$DOMAIN
    
    ‚ö†Ô∏è  –í–ê–ñ–ù–û: –≠—Ç–∞ –∑–∞–ø–∏—Å—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–µ –≤ –≤–∞—à–µ–π DNS –∑–æ–Ω–µ, –∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞!
    –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–≤–æ–µ–º—É —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—É —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å PTR –∑–∞–ø–∏—Å—å!

================================================================================
üí° –ü–†–ò–ú–ï–† –ó–ê–ü–ò–°–ï–ô –î–õ–Ø –î–û–ú–ï–ù–ê example.com:
================================================================================
A      mail.example.com                IN A     192.168.1.100
MX     example.com                     IN MX    10 mail.example.com
TXT    example.com                     IN TXT   "v=spf1 mx a:mail.example.com ~all"
TXT    default._domainkey.example.com  IN TXT   "v=DKIM1; k=rsa; p=–≤–∞—à_–∫–ª—é—á..."
TXT    _dmarc.example.com              IN TXT   "v=DMARC1; p=quarantine; rua=mailto:dmarc@example.com"
CNAME  smtp.example.com                IN CNAME mail.example.com
CNAME  imap.example.com                IN CNAME mail.example.com
'''

def add_letsencrypt_email_input():
    return '''    read -p "–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: $ADMIN_EMAIL): " LETSENCRYPT_EMAIL
    LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL:-$ADMIN_EMAIL}
    echo'''

# –ß–∏—Ç–∞–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç
with open('smtp_ultimate_deploy.sh', 'r', encoding='utf-8') as f:
    content = f.read()

# –î–æ–±–∞–≤–ª—è–µ–º –≤–≤–æ–¥ email –¥–ª—è Let's Encrypt –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
lines = content.split('\n')
new_lines = []
for i, line in enumerate(lines):
    new_lines.append(line)
    if 'read -s -p "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: " EMAIL_PASS' in line:
        new_lines.append('    echo')
        new_lines.append('    read -p "–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è Let\'s Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: $ADMIN_EMAIL): " LETSENCRYPT_EMAIL')
        new_lines.append('    LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL:-$ADMIN_EMAIL}')

# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ email –≤ certbot
content = '\n'.join(new_lines)
content = content.replace('--email $ADMIN_EMAIL', '--email $LETSENCRYPT_EMAIL')

# –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
with open('smtp_ultimate_deploy.sh', 'w', encoding='utf-8') as f:
    f.write(content)

print("üöÄ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´!")
print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤–≤–æ–¥ email –¥–ª—è Let's Encrypt")
print("‚úÖ DNS –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
